---
title: "ALE_LE_exploration"
author: "Kenzie Cooke"
date: "`r Sys.Date()`"
output:output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#include = FALSE omits code chunks and results from showing up in html

#knitr::opts_chunk$set to set global opts that apply to all chunks
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

#echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.

#message = FALSE prevents messages that are generated by code from appearing in the finished file.

#warning = FALSE prevents warnings that are generated by code from appearing in the finished.

#fig.cap = "..." adds a caption to graphical results

```

```{r libraries, include = FALSE}

library(ggplot2)
library(dplyr)
library(nlstools)
library(seacarb)
library(emmeans)
library(broom)
library(lmerTest)
library(tidyr)
library(patchwork)
library(ggsignif)
library(ggpubr)

#re-define treatment names HERE
#color pallette to assign treatments 
treatment_colors <- c(
  AMB = "#52dcbf",   # Light blue
  ELEV = "#1fa1d5",  # You can adjust this color
  HI = "#9d3aa6",    # You can adjust this color
  XHI =  "#6b348f"  )  # Coral

#define custom labels for genotype
labels_genotype <- c("C" = "Coopers",
                     "M" = "Marker 9",
                     "S" = "Sunny Isles")


dose_names <- c("AMB" = "ambient", "ELEV" = "+1200 µM", "HI" = "+1850 µM", "XHI" = "+2000 µM")

```
# Import data, calculate seacarb pco2 values  

Import raw bottle data. Remove all samples whose replicate deltas was >5 and/or had visiual precipitaiton of calcium carbonate in bottles.  Send the remaining coupled DIC/TA samples through Seacarb.. append column to raw bottle data indicating if the calculated pco2 was greater than 1000, 2000 or 5000 (yes or no)  

```{r, echo = TRUE}


# Read the original raw data
forseacarb_raw <- read.csv('data2/bottle_raw.csv', stringsAsFactors = TRUE)


# Filter out samples where delta > 5, precip == "yes", and missing DIC
forseacarb_filtered <- forseacarb_raw %>%
  filter(!delta >= 5) %>%
  filter(!precip == "yes") %>%
  filter(!is.na(DIC) & DIC != "")

# Run seacarb to compute carbonate chemistry
seacarb.output.all = carb(
  flag = 15,
  var1 = forseacarb_filtered$Avg.TA / 10^6,  # Convert TA from umol/kg to mol/kg
  var2 = forseacarb_filtered$DIC / 10^6,  # Convert DIC from umol/kg to mol/kg
  S = forseacarb_filtered$Salinity,  # Salinity (psu)
  T = forseacarb_filtered$temp,  # Temperature (°C)
  P = forseacarb_filtered$dbar / 10  # Pressure (bar)
)

# Add pCO2 results to the filtered dataframe
forseacarb_filtered <- forseacarb_filtered %>%
  mutate(
    pCO2 = seacarb.output.all$pCO2,
    pco1000 = ifelse(pCO2 > 1000, "yes", "no"),
    pco2000 = ifelse(pCO2 > 2000, "yes", "no"),
    pco5000 = ifelse(pCO2 > 5000, "yes", "no")
  )

# Extract only the columns needed for merging
pco2_data <- forseacarb_filtered %>%
  dplyr::select(sample_id, pCO2, pco1000, pco2000, pco5000)

# Merge pCO2 columns back into the original dataset (including missing dic rows)
bottle_all <- forseacarb_raw %>%
  filter(!delta >= 5)%>%
  filter(!precip == "yes")%>%
  left_join(pco2_data, by = "sample_id")


```

# Create filtered bottle sample data sets
Make filtered datasets to calculate average TA for each coral. So now we have:  
bottle_all <- no filtering based on pco2 values  
bottle_5000 <- anything higher than 5000 removed   
bottle_2000 <- anything higher than 2000 removed  
bottle_1000 <- anything higher than 1000 removed  
bottle_feb16 <- no filtering based on pco2, but samples before feb 16 removed. Feb 19th being the date that initial bw and LE measurements taken.
```{r, echo = TRUE}
bottle_1000 <- bottle_all %>%
  filter(pco1000 != 'yes' | is.na(pco1000))

bottle_2000 <- bottle_all %>%
  filter(pco2000 != 'yes' | is.na(pco2000))

bottle_5000 <- bottle_all %>%
  filter(pco5000 != 'yes' | is.na(pco5000))

bottle_feb16 <- bottle_all %>%
  mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%  # Ensure proper conversion
  filter(Date >= as.Date("2024-02-16"))%>%
  filter(pco1000 != "yes"| is.na(pco1000))


```
# Calculate coral TA stats
Generate mean, sd, sem TA for each coral based on filtered bottle data. 
```{r, echo = TRUE}


#Calculate the average ta and standard deviation and standard error for each coral across all dates
ta_coral_all <- bottle_all %>%
  group_by(Coral) %>%
  summarise(
     n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

#filtering out pco2 >1000
ta_coral_1000 <- bottle_1000 %>%
  group_by(Coral) %>%
  summarise(
     n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

ta_coral_2000 <- bottle_2000 %>%
  group_by(Coral) %>%
  summarise(
    n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

ta_coral_5000 <- bottle_5000 %>%
  group_by(Coral) %>%
  summarise(
    n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

ta_coral_feb16 <- bottle_feb16 %>%
  group_by(Coral) %>%
  summarise(
    n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

```
# Growth dataframes
Import ta stats from above filtered data sets into growth dataframes. Create five based on different filtering of chem data.  
growth_all  
growth_5000  
growth_2000  
growth_1000  
growth_feb16  

```{r}

growth_raw <- read.csv('data2/growth_raw.csv', stringsAsFactors = TRUE)

# Merge TA statistics into growth data by coral
growth_all <- growth_raw %>%
  left_join(ta_coral_all, by = "Coral")

growth_all$avg_ta_mmol<-growth_all$avg_ta/1000
growth_all$ta_sd_mmol<-growth_all$ta_sd/1000
growth_all$ta_se_mmol<-growth_all$ta_se/1000

# Create new variable. I converted umol to mmol since the slopes were 0.00 something when the [ta] were in the order of thousands 

# pco1000
growth_1000 <- growth_raw %>%
  left_join(ta_coral_1000, by = "Coral")

growth_1000$avg_ta_mmol<-growth_1000$avg_ta/1000
growth_1000$ta_sd_mmol<-growth_1000$ta_sd/1000
growth_1000$ta_se_mmol<-growth_1000$ta_se/1000

#pco2000
growth_2000 <- growth_raw %>%
  left_join(ta_coral_2000, by = "Coral")

growth_2000$avg_ta_mmol<-growth_2000$avg_ta/1000
growth_2000$ta_sd_mmol<-growth_2000$ta_sd/1000
growth_2000$ta_se_mmol<-growth_2000$ta_se/1000

#pco5000
growth_5000 <- growth_raw %>%
  left_join(ta_coral_5000, by = "Coral")

growth_5000$avg_ta_mmol<-growth_5000$avg_ta/1000
growth_5000$ta_sd_mmol<-growth_5000$ta_sd/1000
growth_5000$ta_se_mmol<-growth_5000$ta_se/1000

#filter samples before feb 16
growth_feb16 <- growth_raw %>%
  left_join(ta_coral_feb16, by = "Coral")

growth_feb16$avg_ta_mmol<-growth_feb16$avg_ta/1000
growth_feb16$ta_sd_mmol<-growth_feb16$ta_sd/1000
growth_feb16$ta_se_mmol<-growth_feb16$ta_se/1000


```

# Alkalinity~LinearExtension models/regression 
## All bottle data
### T1-T2
linear model, stats: 
```{r, echo=TRUE}
#LE mixed effect linear model t1-t3
lmer_all_t1t2 <- lmerTest::lmer(le_t1t2e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_all)
summary(lmer_all_t1t2)
step(lmer_all_t1t2)

```
if you don't consider 0.06 significant?.. no genotype effect, simplest linear model: 

```{r, echo=TRUE}
lm_all_t1t2 <- lm(le_t1t2e ~ avg_ta_mmol, data = growth_all)
summary(lm_all_t1t2)

sl_t1t2 <- coef(lm_all_t1t2)["avg_ta_mmol"]
intercept_t1t2 <- coef(lm_all_t1t2)[1]  # Intercept
summary_model_t1t2 <- summary(lm_all_t1t2)
r_squared_t1t2 <- summary(lm_all_t1t2)$r.squared
pvalue_t1t2 <- summary(lm_all_t1t2)$coefficients[2, 4]

```


```{r}
# Create scatter plot 
scat_t1t2 <- ggplot(data = growth_all, aes(x = avg_ta, y = le_t1t2e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_all$le_t1t2e), max(growth_all$le_t1t2e)))  # Explicitly set y-axis limits

scat_t1t2 <- scat_t1t2 + 
  annotate("text", x = 3700, y = 0.23, 
           label = paste("slope =", round(sl_t1t2, 2), 
                         " R² =", round(r_squared_t1t2, 3), 
                         " p =", signif(pvalue_t1t2, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat_t1t2)

```


### T2 - T3  
For simplicities sake, have not shown linear mixed models/linear model output for the rest of the analysis,  but p value, slope and Rsquared for regression analysis will be on the plots  

```{r, echo = FALSE, include=FALSE}
#LE mixed effect linear model t2-t2
lmer_all_t2t3 <- lmerTest::lmer(le_t2t3e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_all)
summary(lmer_all_t2t3)
step(lmer_all_t2t3)

```

no genotype effect, simplest linear model: 
```{r, echo = FALSE, include=FALSE}
lm_all_t2t3 <- lm(le_t2t3e ~ avg_ta_mmol, data = growth_all)
summary(lm_all_t2t3)

sl_t2t3 <- coef(lm_all_t2t3)["avg_ta_mmol"]
intercept_t2t3 <- coef(lm_all_t2t3)[1]  # Intercept
summary_model_t2t3 <- summary(lm_all_t2t3)
r_squared_t2t3 <- summary(lm_all_t2t3)$r.squared
pvalue_t2t3 <- summary(lm_all_t2t3)$coefficients[2, 4]


```

```{r}
# Create scatter plot 
scat_t2t3 <- ggplot(data = growth_all, aes(x = avg_ta, y = le_t2t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_all$le_t2t3e), max(growth_all$le_t2t3e)))  # Explicitly set y-axis limits

scat_t2t3 <- scat_t2t3 + 
  annotate("text", x = 3700, y = -0.5, 
           label = paste("slope =", round(sl_t2t3, 2), 
                         " R² =", round(r_squared_t2t3, 3), 
                         " p =", signif(pvalue_t2t3, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat_t2t3)


```

### T1-T3  
```{r, echo = FALSE, include=FALSE}
#LE mixed effect linear model t1-t3
lmer_all_t1t3 <- lmerTest::lmer(le_t1t3e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_all)
summary(lmer_all_t1t3)
step(lmer_all_t1t3)

```

no genotype effect, simplest linear model: 
```{r, echo = FALSE, include=FALSE}
lm_all_t1t3 <- lm(le_t1t3e ~ avg_ta_mmol, data = growth_all)
summary(lm_all_t1t3)

sl_t1t3 <- coef(lm_all_t1t3)["avg_ta_mmol"]
intercept_t1t3 <- coef(lm_all_t1t3)[1]  # Intercept
summary_model_t1t3 <- summary(lm_all_t1t3)
r_squared_t1t3 <- summary(lm_all_t1t3)$r.squared
pvalue_t1t3 <- summary(lm_all_t1t3)$coefficients[2, 4]


```

```{r}
# Create scatter plot 
scat_t1t3 <- ggplot(data = growth_all, aes(x = avg_ta, y = le_t1t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_all$le_t1t3e), max(growth_all$le_t1t3e)))  # Explicitly set y-axis limits

scat_t1t3 <- scat_t1t3 + 
  annotate("text", x = 3700, y = 0.12, 
           label = paste("slope =", round(sl_t1t3, 2), 
                         " R² =", round(r_squared_t1t3, 3), 
                         " p =", signif(pvalue_t1t3, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat_t1t3)


```

## Exclude pCO2 > 2000  
Here, we have excluded all bottle samples who had pCO2 > 2000

### T1-T2
linear model, stats: 
```{r, include=FALSE}
#LE mixed effect linear model t1-t3
lmer2_t1t2 <- lmerTest::lmer(le_t1t2e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_2000)
summary(lmer2_t1t2)
step(lmer2_t1t2)

```
no genotype effect, simplest linear model: 

```{r, include=FALSE}
lm2_t1t2 <- lm(le_t1t2e ~ avg_ta_mmol, data = growth_2000)
summary(lm2_t1t2)

sl2_t1t2 <- coef(lm2_t1t2)["avg_ta_mmol"]
intercept2_t1t2 <- coef(lm2_t1t2)[1]  # Intercept
summary_model2_t1t2 <- summary(lm2_t1t2)
r_squared2_t1t2 <- summary(lm2_t1t2)$r.squared
pvalue2_t1t2 <- summary(lm2_t1t2)$coefficients[2, 4]

```


```{r}
# Create scatter plot 
scat2_t1t2 <- ggplot(data = growth_2000, aes(x = avg_ta, y = le_t1t2e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_2000$le_t1t2e), max(growth_2000$le_t1t2e)))  # Explicitly set y-axis limits

scat2_t1t2 <- scat2_t1t2 + 
  annotate("text", x = 3700, y = 0.2, 
           label = paste("slope =", round(sl2_t1t2, 2), 
                         " R² =", round(r_squared2_t1t2, 3), 
                         " p =", signif(pvalue2_t1t2, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat2_t1t2)

```


### T2 - T3
```{r, echo = FALSE, include=FALSE}
#LE mixed effect linear model t2-t2
lmer2_t2t3 <- lmerTest::lmer(le_t2t3e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_2000)
summary(lmer2_t2t3)
step(lmer2_t2t3)

```

no genotype effect, simplest linear model: 
```{r, echo = FALSE, include=FALSE}
lm2_t2t3 <- lm(le_t2t3e ~ avg_ta_mmol, data = growth_2000)
summary(lm2_t2t3)

sl2_t2t3 <- coef(lm2_t2t3)["avg_ta_mmol"]
intercept2_t2t3 <- coef(lm2_t2t3)[1]  # Intercept
summary_model2_t2t3 <- summary(lm2_t2t3)
r_squared2_t2t3 <- summary(lm2_t2t3)$r.squared
pvalue2_t2t3 <- summary(lm2_t2t3)$coefficients[2, 4]


```

```{r}
# Create scatter plot 
scat2_t2t3 <- ggplot(data = growth_2000, aes(x = avg_ta, y = le_t2t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_2000$le_t2t3e), max(growth_2000$le_t2t3e)))  # Explicitly set y-axis limits

scat2_t2t3 <- scat2_t2t3 + 
  annotate("text", x = 3700, y = -0.5, 
           label = paste("slope =", round(sl2_t2t3, 2), 
                         " R² =", round(r_squared2_t2t3, 3), 
                         " p =", signif(pvalue2_t2t3, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat_t2t3)


```

### T1-T3  
```{r, echo = FALSE, include=FALSE}
#LE mixed effect linear model t1-t3
lmer2_t1t3 <- lmerTest::lmer(le_t1t3e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_2000)
summary(lmer2_t1t3)
step(lmer2_t1t3)

```

no genotype effect, simplest linear model: 
```{r, echo = FALSE, include=FALSE}
lm2_t1t3 <- lm(le_t1t3e ~ avg_ta_mmol, data = growth_2000)
summary(lm2_t1t3)

sl2_t1t3 <- coef(lm2_t1t3)["avg_ta_mmol"]
intercept2_t1t3 <- coef(lm2_t1t3)[1]  # Intercept
summary_model2_t1t3 <- summary(lm2_t1t3)
r_squared2_t1t3 <- summary(lm2_t1t3)$r.squared
pvalue2_t1t3 <- summary(lm2_t1t3)$coefficients[2, 4]


```

```{r}
# Create scatter plot 
scat2_t1t3 <- ggplot(data = growth_2000, aes(x = avg_ta, y = le_t1t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_2000$le_t1t3e), max(growth_2000$le_t1t3e)))  # Explicitly set y-axis limits

scat2_t1t3 <- scat2_t1t3 + 
  annotate("text", x = 3700, y = 0.12, 
           label = paste("slope =", round(sl2_t1t3, 2), 
                         " R² =", round(r_squared2_t1t3, 3), 
                         " p =", signif(pvalue2_t1t3, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat2_t1t3)


```

## Only samples collected after Feb 16th  
Here, we have excluded all bottle samples that were colleected before Feb 16th

### T1-T2
linear model, stats: 
```{r, include=FALSE}
#LE mixed effect linear model t1-t3
lmer16_t1t2 <- lmerTest::lmer(le_t1t2e ~ avg_ta_mmol + (1|geno) + (1|tank), data = growth_feb16)
summary(lmer16_t1t2)
step(lmer16_t1t2)

```
no genotype effect, simplest linear model: 

```{r, include=FALSE}
lm16_t1t2 <- lm(le_t1t2e ~ avg_ta_mmol, data = growth_feb16)
summary(lm16_t1t2)

sl16_t1t2 <- coef(lm16_t1t2)["avg_ta_mmol"]
intercept16_t1t2 <- coef(lm16_t1t2)[1]  # Intercept
summary_model16_t1t2 <- summary(lm16_t1t2)
r_squared16_t1t2 <- summary(lm16_t1t2)$r.squared
pvalue16_t1t2 <- summary(lm16_t1t2)$coefficients[2, 4]

```


```{r}
# Create scatter plot 
scat16_t1t2 <- ggplot(data = growth_feb16, aes(x = avg_ta, y = le_t1t2e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_feb16$le_t1t2e), max(growth_feb16$le_t1t2e)))  # Explicitly set y-axis limits

scat16_t1t2 <- scat16_t1t2 + 
  annotate("text", x = 3700, y = 0.2, 
           label = paste("slope =", round(sl16_t1t2, 2), 
                         " R² =", round(r_squared16_t1t2, 3), 
                         " p =", signif(pvalue16_t1t2, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat16_t1t2)

```


### T2 - T3
 
```{r, echo = FALSE, include=FALSE}
lm16_t2t3 <- lm(le_t2t3e ~ avg_ta_mmol, data = growth_feb16)
summary(lm16_t2t3)

sl16_t2t3 <- coef(lm16_t2t3)["avg_ta_mmol"]
intercept16_t2t3 <- coef(lm16_t2t3)[1]  # Intercept
summary_model16_t2t3 <- summary(lm16_t2t3)
r_squared16_t2t3 <- summary(lm16_t2t3)$r.squared
pvalue16_t2t3 <- summary(lm16_t2t3)$coefficients[2, 4]


```

```{r}
# Create scatter plot 
scat16_t2t3 <- ggplot(data = growth_feb16, aes(x = avg_ta, y = le_t2t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_feb16$le_t2t3e), max(growth_feb16$le_t2t3e)))  # Explicitly set y-axis limits

scat16_t2t3 <- scat16_t2t3 + 
  annotate("text", x = 3700, y = -0.5, 
           label = paste("slope =", round(sl16_t2t3, 2), 
                         " R² =", round(r_squared16_t2t3, 3), 
                         " p =", signif(pvalue16_t2t3, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat16_t2t3)


```

### T1-T3  

no genotype effect, simplest linear model: 
```{r, echo = FALSE, include=FALSE}
lm16_t1t3 <- lm(le_t1t3e ~ avg_ta_mmol, data = growth_feb16)
summary(lm16_t1t3)

sl16_t1t3 <- coef(lm16_t1t3)["avg_ta_mmol"]
intercept16_t1t3 <- coef(lm16_t1t3)[1]  # Intercept
summary_model16_t1t3 <- summary(lm16_t1t3)
r_squared16_t1t3 <- summary(lm16_t1t3)$r.squared
pvalue16_t1t3 <- summary(lm16_t1t3)$coefficients[2, 4]


```

```{r}
# Create scatter plot 
scat16_t1t3 <- ggplot(data = growth_feb16, aes(x = avg_ta, y = le_t1t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu*mol~kg^-1))) + 
  ylab(expression(Linear~extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
  coord_cartesian(ylim = c(min(growth_feb16$le_t1t3e), max(growth_feb16$le_t1t3e)))  # Explicitly set y-axis limits

scat16_t1t3 <- scat16_t1t3 + 
  annotate("text", x = 3700, y = 0.12, 
           label = paste("slope =", round(sl16_t1t3, 2), 
                         " R² =", round(r_squared16_t1t3, 3), 
                         " p =", signif(pvalue16_t1t3, 3)), 
           color = "black", size = 3.5, fontface = "bold", hjust = 1)
print(scat16_t1t3)


```

