---
title: "ALE Data exploration"
author: "Kenzie Cooke"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
#include = FALSE omits code chunks and results from showing up in html

#knitr::opts_chunk$set to set global opts that apply to all chunks
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

#echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.

#message = FALSE prevents messages that are generated by code from appearing in the finished file.

#warning = FALSE prevents warnings that are generated by code from appearing in the finished.

#fig.cap = "..." adds a caption to graphical results


```

```{r libraries}

library(ggplot2)
library(dplyr)
library(nlstools)
library(seacarb)
library(emmeans)
library(broom)
library(lmerTest)
library(tidyr)
library(patchwork)
library(ggsignif)
library(ggpubr)
```

# Quality Control of carbonate chemistry  

```{r import data}
#import all bottle sample data, unfiltered
carbchem <- read.csv('data2/carbchem.csv', stringsAsFactors = TRUE)

ta_time  <- read.csv('data2/ta_all.csv', stringsAsFactors = TRUE)

```

Alkalinity bottle sample quality. Each sample is run in replicate for quality control. If the replicates are within an acceptable threshold (usually < 5umol difference), then the mean of the replicates is used as the final TA value for that sample. The difference in umol between each replicate (deltas) for all collected samples are plotted below  

## Instrument precision (replicate deltas)    

### AllBottles_delta(umol)

Histogram depicts deltas between replicates of all 526 alkalinity samples collected for from February 7th to March 19th, 2024  


```{r AllBottles_delta}
delta <- ta_time$delta
hist(delta)
```

### Deltas by treatment  

```{r}
#histogram of deltas

hist_treat <-ggplot(ta_time, aes(x=delta))+
  geom_histogram(color="black", fill="white")+
  facet_grid(treat ~ .)

hist_treat


```

### deltas > 5 umol by treatment  

```{r}
# Filter data for delta > 5
filtered_data <- ta_time[ta_time$delta > 5, ]


#histogram of filtered data
hist_filt <- ggplot(filtered_data, aes(x=delta))+
  geom_histogram(color="black", fill="white")+
  facet_grid(treat ~ .)

hist_filt

```

## Precipitation  

### PrecipitatedSamples_treatment  

```{r, fig.cap="number of samples with confirmed visual precipitation in bottles post collection. Not confident that all samples with precipitatin were noted down."}

filter_precip <- ta_time[ta_time$precip != "no",]

#create barplot
bar_precip <- ggplot(filter_precip)+
  geom_bar(aes(x=precip))+
  facet_wrap(treat~.)

bar_precip

```


### Number of samples with suspicious pCO2 values  

Carbchem parameters generated using all bottle samples (DIC and TA)
```{r, fig.cap="Datapoints where computed pCO2 (using DIC and TA in seacarb) produced suspicious values (likely due to visible precipitation in bottle samples post collection)"}

# Recode the precipvalues from discrete to continuous

filtered_dataP <- carbchem[carbchem$precip != "a",]

precip_bar <- ggplot(filtered_dataP, aes(x=precip))+
  geom_bar(color= "black", fill = "white") +
  labs(x="pCO2 > xxxx", y="count") +
  facet_wrap(treat~.) +
  scale_x_discrete(labels = c("b" = ">1000", "c" = ">5000"))

precip_bar
```



## Stability of treatments over time  



```{r}
#convert date column to "Date" type.
ta_time$date <- as.Date(ta_time$date, format = "%m/%d/%Y")

# Get the unique dates from the data
unique_dates <- unique(ta_time$date)

#transform continuous deltas to categorical variables
#ta_time$delta <- factor(ta_time$delta)

#create new column with categorical variables <5, <10, >15 , over 15
ta_time$delta_bin <- cut(
  ta_time$delta,
  breaks = c(-Inf, 5, 10, 15, Inf),
  labels = c("<5", "<10", "<15", ">15"),
  right = FALSE
)

t_colors <- c("<5" = "gray", "<10" = "hotpink", "<15"="blue", ">15"="purple")

#filter by treatment
tr_amb <- ta_time[ta_time$treat == "amb",]
tr_ele <- ta_time[ta_time$treat =="elev",]
tr_hi <- ta_time[ta_time$treat =="hi",]
tr_xhi <- ta_time[ta_time$treat =="xhi",]

```


### AmbientTreat_time


```{r, fig.cap="Ambient treatment over time using all bottle sample data"}


treat_stab_amb <- ggplot(tr_amb, aes(x = date, y = calc_avg_ta, color = delta_bin, shape = precip)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = t_colors)



treat_stab_amb
```

### ElevatedTreat_time



```{r}
treat_stab_ele <- ggplot(tr_ele, aes(x = date, y = calc_avg_ta, color = delta_bin, shape = precip)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = t_colors)


treat_stab_ele
```

### HighTreat_time
```{r}
treat_stab_hi <- ggplot(tr_hi, aes(x = date, y = calc_avg_ta, color = delta_bin, shape = precip)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = t_colors)


treat_stab_hi
```

### XhiTreat_time
```{r}
treat_stab_xhi <- ggplot(tr_xhi, aes(x = date, y = calc_avg_ta, color = delta_bin, shape = precip)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = t_colors)


treat_stab_xhi
```


### TA_Time (precipitation excluded, >5umol delta excluded)

Total samples collected over course of the experiment excluding those with precipitation and any with delta >5 umol> Left with 399 samples. Down from 550, eliminated 151 samples. 

Break down of remaining samples:  

ambient	128  

elevated	114  

hi	87  

xhi	67  


Updated plots below. Can see that in the hi and extra high treamtents, gets as low as four samples per time point towards the end of the experiment (down from 12 per tiempoint per treatment). 

```{r}
d_filt <- ta_time[ta_time$delta <= 5 & ta_time$precip != "yes",]

p <- ggplot(d_filt, aes(x = date, y = calc_avg_ta, color = treat)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p

d_amb <-  ta_time[ta_time$delta <= 5 & ta_time$precip != "yes" & ta_time$treat == "amb",]
p_amb <- ggplot(d_amb, aes(x = date, y = calc_avg_ta)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  ggtitle("'Ambient' treatment over time") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

p_amb

d_ele <- ta_time[ta_time$delta <= 5 & ta_time$precip != "yes" & ta_time$treat == "elev",]
p_ele <- ggplot(d_ele, aes(x = date, y = calc_avg_ta)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  ggtitle("'Elevated' treatment over time") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p_ele

d_hi <- ta_time[ta_time$delta <= 5 & ta_time$precip != "yes" & ta_time$treat == "hi",]
p_hi <- ggplot(d_hi, aes(x = date, y = calc_avg_ta)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +  
  theme_classic()+
  ggtitle(" 'high' treatment over time") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p_hi

d_xhi <- ta_time[ta_time$delta <= 5 & ta_time$precip != "yes" & ta_time$treat == "xhi",]
p_xhi <- ggplot(d_xhi, aes(x = date, y = calc_avg_ta)) +
  geom_point() +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) + 
  ggtitle("'Extra high' treatment over time") +
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p_xhi

```


# QC Growth rates
Took timepoint 0 on Feb 3rd. Corals were placed in vessels and ramped up to treatment levels for four days. Were at full treatment dosage on Feb 7. Noticed the lights were not set to the same parameters on Feb 15th. Corrected and took new datapoint on Feb 19th (T1). Took another point on March 8th (T2) and endpoint on March 23rd (T3). 

## Growth rates over time  

```{r}
bwrates <- read.csv('data2/bw_rates.csv', stringsAsFactors = TRUE)

lerates <- read.csv('data2/le_rates_edit.csv', stringsAsFactors = TRUE)

```

### Total calcification growth rates across timepoints  

```{r, fig.cap="total calcificaiton growth rates across timepoints"}
# Convert the data from wide format to long format
bw_long <- bwrates %>%
  pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate")  %>%
  filter(timepoint != "gr_t0t3" & timepoint != "gr_t1t3")

# Rename the column from 'treatment' to 'dose'
#if ("treatment" %in% colnames(bwrates)) {
 # bwrates <- bwrates %>%
  #  rename(dose = treatment)
#}

dose_names <- c("AMB" = "ambient", "ELEV" = "+0.22", "HI" = "+0.44", "XHI" = "+0.66")

# Create the boxplot
bw_boxrateALL <- ggplot(bw_long, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "dose (mL) ") +
   ylab(expression(Growth~rate~(mg~cm^2^-1~day^-1))) +
  theme_minimal() +
    scale_fill_brewer(palette = "Set3", labels = dose_names)
  
bw_boxrateALL
```


```{r, fig.cap= "Using initial timepoint zero to end (left) vs. using second timepoint zero to end (right)"}

bwshort <- bwrates %>%
   pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate")  %>%
  filter(timepoint != "gr_t0t1" & timepoint != "gr_t1t2" & timepoint != "gr_t2t3")

bw_boxrate <- ggplot(bwshort, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "dose (mL) ") +
   ylab(expression(Growth~rate~(mg~cm^2^-1~day^-1))) +
  theme_minimal() +
    scale_fill_brewer(palette = "Set3", labels = dose_names)

bw_boxrate
  
```
### Linear extension
#### Standards  
```{r, fig.cap="Measured a standard in three photos from each timepoint to check precision/accuracy of imageJ method across timepoints"}

library(ggplot2)
library(dplyr)

tporder <- c("one", "two", "three")
tp_labels <- c("February 19th", "March 8th", "March 23rd") 

le_st <- read.csv('data2/le_stand.csv', stringsAsFactors = TRUE)

# Remove T0 (i.e., "zero")
le_st_filtered <- le_st %>% filter(tp != "zero")

le_stands <- ggplot(le_st_filtered, aes(x = factor(tp, levels = tporder), y = length)) +
  scale_x_discrete(labels = tp_labels) +
  geom_boxplot() +
  geom_jitter() +
  theme_classic() +
  theme(
    axis.title.x = element_text(size = 22),
    axis.title.y = element_text(size = 22),
    axis.text = element_text(size = 17)
  ) +
  labs(x = "Timepoint", y = "Length (mm)") +
  ylim(22.5, 25)

le_stands

```
Across all timepoints, the ImageJ method has a standard deviation of ± 0.39 mm  and a standard error of ± 0.11 mm. 



Timepoint two's standard is measuring nearly 0.75 mm shorter than timepoints zero and one. Can I apply an offset or something to correct for it?  


#### Linear extension growth rates across timepoints  
You'll notice a a few negative rates from t2 to t3. The -0.4 mm/day rate comes from a coral that died three days after timepoint and it had a -1.47 mm difference in total length between tp2 and 3. I am going to maybe re-analyze the photos from timepoint 2. 

```{r, fig.cap="linear extension growth rates across all timepoints. Going to investigate the super negative rates."}
le_long <- lerates %>%
  pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate")  %>%
  filter(timepoint != "gr_t0t3" & timepoint != "gr_t1t3")

# Rename the column from 'treatment' to 'dose'
#if ("treatment" %in% colnames(lerates)) {
 # lerates <- lerates %>%
  #  rename(dose = treatment)
#}

# Create the boxplot
le_boxrateALL <- ggplot(le_long, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "dose (mL) ") +
   ylab(expression(Growth~rate~(mm~day^-1)))+
  theme_minimal() +
    scale_fill_brewer(palette = "Set3", labels = dose_names)
  
le_boxrateALL
```

```{r, fig.cap="Using initial timepoint zero - end (left) vs. using second timeppoint zero to end (right)"}
leshort <- lerates %>%
   pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate")  %>%
  filter(timepoint != "gr_t0t1" & timepoint != "gr_t1t2" & timepoint != "gr_t2t3")

le_boxrate <- ggplot(leshort, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "dose (mL) ") +
   ylab(expression(Growth~rate~(mm~day^-1))) +
  theme_minimal() +
    scale_fill_brewer(palette = "Set3", labels = dose_names)

le_boxrate
```
### Linear extension with offset correction
Growth results with linear extension offset applied to each timepoint. Took the mean standard length of timepoint 1 and (24.1 mm) and calculated offset for each timepoint that would bring the mean to 24.1 mm.  

t0 = offset of +0.02 mm  
t1 = no offset  
t2 = offset of + 0.873 mm  
t3 = offset of + 0.383 mm  

Comparing growth rates withdout and with the offset applied (gr_t0t1 vs grt0t1e) "e" standing for edited.  


```{r}
leratese <-  read.csv('data2/le_rates_edit.csv', stringsAsFactors = TRUE)

le_longe <- leratese %>%
  pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate")  %>%
  filter(timepoint != "gr_t0t3" & timepoint != "gr_t1t3" & timepoint != "gr_t0t3e" & timepoint != "gr_t1t3e",)

le_boxrateALLe <- ggplot(le_longe, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "dose (mL) ") +
   ylab(expression(Growth~rate~(mm~day^-1)))+
  theme_minimal() +
    scale_fill_brewer(palette = "Set3", labels = dose_names)
  
le_boxrateALLe

leshorte <- leratese %>%
   pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate")  %>%
  filter(timepoint != "gr_t0t1" & timepoint != "gr_t0t1e" & timepoint != "gr_t1t2" & timepoint != "gr_t1t2e" & timepoint != "gr_t2t3" &timepoint != "gr_t2t3e")

le_boxratee <- ggplot(leshorte, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "dose (mL) ") +
   ylab(expression(Growth~rate~(mm~day^-1))) +
  theme_minimal() +
    scale_fill_brewer(palette = "Set3", labels = dose_names)

le_boxratee

```


# Results  
## Fv/Fm
```{r}
ipam_data <- read.csv('data2/ale_ipam.csv', stringsAsFactors = TRUE)
library(lmerTest)
#A
anova(lm(fvfm ~ treat + geno, data = ipam_data))
range(ipam_data$fvfm, na.rm = TRUE)
mean(ipam_data$fvfm, na.rm = TRUE)
se_fvfm <- sd(ipam_data$fvfm, na.rm = TRUE) / sqrt(sum(!is.na(ipam_data$fvfm)))
se_fvfm


```

```{r}
# Create the data frame
value <- c(0.548, 0.578, 0.550, 0.552, 0.470, 0.536, 0.591, 0.488,    # AMB
           0.585, 0.599, 0.509, 0.614, 0.550, 0.482, 0.517,            # ELEV
           0.607, 0.610, 0.567, 0.557, 0.565, 0.593, 0.554, 0.572, 0.626,  # HI
           0.565, 0.596, 0.550, 0.579, 0.513, 0.558, 0.613, 0.543, 0.523)  # XHI

# Create a vector indicating treatment groups for each value
treatment <- c(rep("AMB", 8), rep("ELEV", 7), rep("HI", 9), rep("XHI", 9))

# Combine into a data frame
ipamdata <- data.frame(value = value, treatment = treatment)

# Perform the one-way ANOVA
anova_ipam <- aov(value ~ treatment, data = ipamdata)

# Summary of the ANOVA
summary(anova_ipam)
```


Import raw bottle chemistry data. filter out deltas and precipitation samples. Run remainder through Seacarb, appendn pco2 columns. Now have chemistry data that lists info on seacarb pco2 values.


```{r}


# Read the original raw data
forseacarb_raw <- read.csv('data2/bottle_raw.csv', stringsAsFactors = TRUE)


# Filter out samples where delta > 5, precip == "yes", and missing DIC
forseacarb_filtered <- forseacarb_raw %>%
  filter(!delta >= 5) %>%
  filter(!precip == "yes") %>%
  filter(!is.na(DIC) & DIC != "")

# Run seacarb to compute carbonate chemistry
seacarb.output.all = carb(
  flag = 15,
  var1 = forseacarb_filtered$Avg.TA / 10^6,  # Convert TA from umol/kg to mol/kg
  var2 = forseacarb_filtered$DIC / 10^6,  # Convert DIC from umol/kg to mol/kg
  S = forseacarb_filtered$Salinity,  # Salinity (psu)
  T = forseacarb_filtered$temp,  # Temperature (°C)
  P = forseacarb_filtered$dbar / 10  # Pressure (bar)
)

# Add pCO2 results to the filtered dataframe
forseacarb_filtered <- forseacarb_filtered %>%
  mutate(
    pCO2 = seacarb.output.all$pCO2,
    pco1000 = ifelse(pCO2 > 1000, "yes", "no"),
    pco2000 = ifelse(pCO2 > 2000, "yes", "no"),
    pco5000 = ifelse(pCO2 > 5000, "yes", "no")
  )

# Extract only the columns needed for merging
pco2_data <- forseacarb_filtered %>%
  dplyr::select(sample_id, pCO2, pco1000, pco2000, pco5000)

# Merge pCO2 columns back into the original dataset (including missing dic rows)
bottle_all <- forseacarb_raw %>%
  filter(!delta >= 5)%>%
  filter(!precip == "yes")%>%
  left_join(pco2_data, by = "sample_id")


```

 Create filtered chemistry data sets
```{r}
bottle_1000 <- bottle_all %>%
  filter(pco1000 != 'yes' | is.na(pco1000))

bottle_2000 <- bottle_all %>%
  filter(pco2000 != 'yes' | is.na(pco2000))

bottle_5000 <- bottle_all %>%
  filter(pco5000 != 'yes' | is.na(pco5000))
  

```
Create stats for corals based on different filtered chemistry data sets
```{r, results = "hide"}


#Calculate the average ta and standard deviation and standard error for each coral across all dates
ta_coral_all <- bottle_all %>%
  group_by(Coral) %>%
  summarise(
     n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

#filtering out pco2 >1000
ta_coral_1000 <- bottle_1000 %>%
  group_by(Coral) %>%
  summarise(
     n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

ta_coral_2000 <- bottle_2000 %>%
  group_by(Coral) %>%
  summarise(
    n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )

ta_coral_5000 <- bottle_5000 %>%
  group_by(Coral) %>%
  summarise(
    n = sum(!is.na(Avg.TA)),  # Count of non-NA values
    avg_ta = mean(Avg.TA, na.rm = TRUE),
    ta_sd = sd(Avg.TA, na.rm = TRUE),
    ta_se = sd(Avg.TA, na.rm = TRUE) / sqrt(n())
  )



```
Import ta stats from above filtered data sets into growth dataframes. Create four based on different filtering of chem data. 

```{r}

growth_raw <- read.csv('data2/growth_raw.csv', stringsAsFactors = TRUE)

# Merge TA statistics into growth data by coral
growth_all <- growth_raw %>%
  left_join(ta_coral_all, by = "Coral")

growth_all$avg_ta_mmol<-growth_all$avg_ta/1000
growth_all$ta_sd_mmol<-growth_all$ta_sd/1000
growth_all$ta_se_mmol<-growth_all$ta_se/1000
# Create new variable. I converted umol to mmol since the slopes were 0.00 something when the [ta] were in the order of thousands 

# pco1000
growth_1000 <- growth_raw %>%
  left_join(ta_coral_1000, by = "Coral")

growth_1000$avg_ta_mmol<-growth_1000$avg_ta/1000
growth_1000$ta_sd_mmol<-growth_1000$ta_sd/1000
growth_1000$ta_se_mmol<-growth_1000$ta_se/1000

#pco2000
growth_2000 <- growth_raw %>%
  left_join(ta_coral_2000, by = "Coral")

growth_2000$avg_ta_mmol<-growth_2000$avg_ta/1000
growth_2000$ta_sd_mmol<-growth_2000$ta_sd/1000
growth_2000$ta_se_mmol<-growth_2000$ta_se/1000

#pco5000
growth_5000 <- growth_raw %>%
  left_join(ta_coral_5000, by = "Coral")

growth_5000$avg_ta_mmol<-growth_5000$avg_ta/1000
growth_5000$ta_sd_mmol<-growth_5000$ta_sd/1000
growth_5000$ta_se_mmol<-growth_5000$ta_se/1000


```

## DECIDE CUTOFF for PCO2 values
```{r}
bottle_d <- bottle_2000
grdata <- growth_2000
```


Data analysis using bottle data excluding deltas > or equal to 5 umol and any with precipitation.  

##  Carb chem parameters    
Carb chem parameters generated using seacarb with measured DIC and TA values. Includes samples from 2/3 - 3/23.  

###Coral beakers


```{r}

#sort data by treatment, exclude blanks
amb_d <- bottle_d[bottle_d$Treatment == "AMB" & bottle_d$Coral != "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.amb = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = amb_d$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = amb_d$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = amb_d$Salinity,
 
  #temperature, in deg C
  T = amb_d$temp,
 
  #pressure, need to convert from dbar to bar
  P = amb_d$dbar/ 10
)

#Elevated treatment
elev_d <- bottle_d[bottle_d$Treatment == "ELEV" &  bottle_d$Coral != "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.elev = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = elev_d$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = elev_d$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = elev_d$Salinity,
 
  #temperature, in deg C
  T = elev_d$temp,
 
  #pressure, need to convert from dbar to bar
  P = elev_d$dbar/ 10
)

#High Treatment
hi_d <- bottle_d[bottle_d$Treatment == "HI" & bottle_d$Coral != "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.hi = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = hi_d$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = hi_d$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = hi_d$Salinity,
 
  #temperature, in deg C
  T = hi_d$temp,
 
  #pressure, need to convert from dbar to bar
  P = hi_d$dbar/ 10
)

#Extra high treatment
xhi_d <- bottle_d[bottle_d$Treatment == "XHI" & bottle_d$Coral != "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.xhi = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = xhi_d$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = xhi_d$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = xhi_d$Salinity,
 
  #temperature, in deg C
  T = xhi_d$temp,
 
  #pressure, need to convert from dbar to bar
  P = xhi_d$dbar/ 10
)

```

### Blank Beakers
```{r}
#Now do seacarb parameters for Blanks 
#sort data by treatment 
amb_blank <- bottle_d[bottle_d$Treatment == "AMB" & bottle_d$Coral == "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.amb_blank = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = amb_blank$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = amb_blank$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = amb_blank$Salinity,
 
  #temperature, in deg C
  T = amb_blank$temp,
 
  #pressure, need to convert from dbar to bar
  P = amb_blank$dbar/ 10
)

#Elevated treatment
elev_blank <- bottle_d[bottle_d$Treatment == "ELEV" &  bottle_d$Coral == "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.elev.blank = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = elev_blank$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = elev_blank$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = elev_blank$Salinity,
 
  #temperature, in deg C
  T = elev_blank$temp,
 
  #pressure, need to convert from dbar to bar
  P = elev_blank$dbar/ 10
)

#High Treatment
hi_blank <- bottle_d[bottle_d$Treatment == "HI" & bottle_d$Coral == "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.hi.blank = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = hi_blank$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = hi_blank$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = hi_blank$Salinity,
 
  #temperature, in deg C
  T = hi_blank$temp,
 
  #pressure, need to convert from dbar to bar
  P = hi_blank$dbar/ 10
)

#Extra high treatment
xhi_blank <- bottle_d[bottle_d$Treatment == "XHI" & bottle_d$Coral == "Blank" & !is.na(bottle_d$DIC),]
  
seacarb.output.xhi.blank = carb(
  #flag refers to which two CO2 system variables are being used; here we are using ALK and DIC
  flag = 15,
 
  #need to convert TA from umol/kg to mol/kg
  var1 = xhi_blank$Avg.TA / 10 ^ 6,
 
  #need to convert DIC from umol/kg to mol/kg
  var2 = xhi_blank$DIC / 10 ^ 6,
 
  #salinity, in psu
  S = xhi_blank$Salinity,
 
  #temperature, in deg C
  T = xhi_blank$temp,
 
  #pressure, need to convert from dbar to bar
  P = xhi_blank$dbar/ 10
)
```
###Print carb chem data

```{r}
stats_amb <- seacarb.output.amb %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )
stats_amb_blank <- seacarb.output.amb_blank %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )


# elevated
stats_elev <- seacarb.output.elev %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )
stats_elev_blank <- seacarb.output.elev.blank %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )

#high
stats_hi <- seacarb.output.hi %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )
stats_hi_blank <- seacarb.output.hi.blank %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )


#xhi
stats_xhi <- seacarb.output.xhi %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )
stats_xhi_blank <- seacarb.output.xhi.blank %>%
  summarise(
    n = sum(!is.na(.[[1]])),  # Count non-NA values from any column
    across(everything(), list(
      mean = ~mean(.x, na.rm = TRUE),
      SEM = ~sd(.x, na.rm = TRUE) / sqrt(n)
    ), .names = "{.col}_{.fn}")
  )


```


Export stats to carb chem table 

```{r}
# Load necessary libraries
library(dplyr)
library(tidyr)
library(writexl)

# Add a treatment and type column
stats_amb <- stats_amb %>% mutate(Treatment = "AMB", Type = "Regular")
stats_amb_blank <- stats_amb_blank %>% mutate(Treatment = "AMB", Type = "Blank")

stats_elev <- stats_elev %>% mutate(Treatment = "ELEV", Type = "Regular")
stats_elev_blank <- stats_elev_blank %>% mutate(Treatment = "ELEV", Type = "Blank")

stats_hi <- stats_hi %>% mutate(Treatment = "HI", Type = "Regular")
stats_hi_blank <- stats_hi_blank %>% mutate(Treatment = "HI", Type = "Blank")

stats_xhi <- stats_xhi %>% mutate(Treatment = "XHI", Type = "Regular")
stats_xhi_blank <- stats_xhi_blank %>% mutate(Treatment = "XHI", Type = "Blank")

# Combine all tables
combined_stats <- bind_rows(
  stats_amb, stats_amb_blank,
  stats_elev, stats_elev_blank,
  stats_hi, stats_hi_blank,
  stats_xhi, stats_xhi_blank
)

# Load necessary packages
library(dplyr)
library(tidyr)
library(writexl)
library(flextable)
library(officer)

# Define the variables to keep in the correct orde
vars_to_keep <- c(
  "n", 
  "ALK_mean", "ALK_SEM", 
  "DIC_mean", "DIC_SEM", 
  "pCO2_mean", "pCO2_SEM", 
  "pH_mean", "pH_SEM", 
  "OmegaAragonite_mean", "OmegaAragonite_SEM", 
  "HCO3_mean", "HCO3_SEM", 
  "CO3_mean", "CO3_SEM", 
  "S_mean", "S_SEM"
)

# Filter only the selected variables
stats_filtered <- combined_stats %>%
  pivot_longer(cols = -c(Treatment, Type), 
               names_to = c("Variable"),
               values_to = "Value") %>%
  filter(Variable %in% vars_to_keep)

# Reshape into wide format (treatment as columns, mean & SEM under each)
stats_wide <- stats_filtered %>%
  pivot_wider(names_from = Treatment, 
              values_from = Value,
              names_glue = "{Treatment}_{.value}")

# Ensure columns match the desired output format
col_order <- c("Variable", "Type", 
               "AMB", "AMB_SEM", 
               "ELEV", "ELEV_SEM", 
               "HI", "HI_SEM", 
               "XHI", "XHI_SEM")

# Rename columns for clarity
colnames(stats_wide) <- gsub("_mean", "", colnames(stats_wide))
colnames(stats_wide) <- gsub("_SEM", " SEM", colnames(stats_wide))

# Arrange the data in the correct order
stats_wide <- stats_wide %>%
  arrange(match(Variable, vars_to_keep))




```

### ANOVA_treatments  

Was alkalinity statistically different between treatments?   

```{r}

#install.packages('multcomp')# install multcomp before!
#install.packages('multcompView')
library(multcomp)
library(multcompView)

treat_aov <- aov(avg_ta_mmol ~ treatment, data = grdata)
summary(treat_aov)

treat_aov_2 <- lm(avg_ta_mmol ~ treatment, data = grdata)
 summary(treat_aov_2)

TAemmean<-cld(emmeans(treat_aov_2, ~treatment), Letters = letters)
TAemmean
pairs(emmeans(treat_aov_2, ~treatment), adjust = "tukey")
#tukey_treat <- cld(TukeyHSD(treat_aov))
#print(tukey_treat)


```
All treatments statistically different from eachother (p < 0.000) except for the extra high and high treatments (p = 0.53)  

### Stability of treatment over time
#### TA by treatment barplot and boxplot  

```{r}
#ta_time <- read.csv('data/ta_time.csv', stringsAsFactors = TRUE)


#re-define treatment names HERE
#color pallette to assign treatments 
treatment_colors <- c(
  AMB = "#52dcbf",   # Light blue
  ELEV = "#1fa1d5",  # You can adjust this color
  HI = "#9d3aa6",    # You can adjust this color
  XHI =  "#6b348f"  )  # Coral

dose_names <- c("AMB" = "ambient", "ELEV" = "+1200 µM", "HI" = "+1850 µM", "XHI" = "+2000 µM")
ta_summary <- bottle_d %>%
  group_by(Treatment) %>%
  summarise(
    mean_ta = mean(Avg.TA),
    sem_ta = sd(Avg.TA) / sqrt(n())
  )
print(ta_summary)

bar_ta <- ggplot(ta_summary, aes(x = Treatment, y = mean_ta)) +
  geom_bar(stat = "identity", position = position_dodge(), width = 0.7) +
  geom_errorbar(aes(ymin = mean_ta - sem_ta, ymax = mean_ta + sem_ta),width = 0.2,position = position_dodge(0.7)) +
  theme_classic()+
  scale_x_discrete(labels = dose_names)

bar_ta

#boxplot 

y_limits <- c(min(bottle_d$Avg.TA), max(bottle_d$Avg.TA))  # Set y-axis limits

box_ta <- ggplot(bottle_d, aes(x = Treatment, y = Avg.TA, fill=Treatment)) +
  geom_boxplot() +
  ylab(NULL) +
  xlab("Treatment")+
  scale_x_discrete(labels = dose_names)+
  theme_classic(base_size = 15)+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))+
   theme(
    axis.title.x = element_text(size = 20),    # Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18)     # Optionally adjust legend title size
  ) +
  scale_fill_manual(values = treatment_colors, labels = dose_names)+
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]))+
  
   geom_text(aes(x = "AMB", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "AMB"]), label = "a"), vjust = -0.5, size = 5, color = "black") +
  
  geom_text(aes(x = "ELEV", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "ELEV"]), label = "b"), vjust = -0.5, size = 5, color = "black") +
  
  geom_text(aes(x = "HI", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "HI"]), label = "c"), vjust = -0.5, size = 5, color = "black") +
  
  geom_text(aes(x = "XHI", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "XHI"]), label = "c"), vjust = -0.5, size = 5, color = "black")+
   coord_cartesian(ylim = y_limits) 



box_ta

# Create a summary table for sample sizes
sample_sizes <- bottle_d %>%
  group_by(Treatment) %>%
  summarise(n = n(), 
            lower_whisker = quantile(Avg.TA, 0.25, na.rm = TRUE))  # Get Q1 for placement

y_limits <- c(min(bottle_d$Avg.TA), max(bottle_d$Avg.TA))  # Set y-axis limits

box_ta <- ggplot(bottle_d, aes(x = Treatment, y = Avg.TA, fill = Treatment)) +
  geom_boxplot() +
  ylab(NULL) +
  xlab("Treatment") +
  scale_x_discrete(labels = dose_names) +
  theme_classic(base_size = 15) +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  theme(
    axis.title.x = element_text(size = 20),    
    axis.title.y = element_text(size = 20),    
    axis.text = element_text(size = 19),       
    legend.text = element_text(size = 16),     
    legend.title = element_text(size = 18)     
  ) +
  scale_fill_manual(values = treatment_colors, labels = dose_names) +
  labs(colour = expression(Treatment ~ A[ T ]), fill = expression(Treatment ~ A[ T ])) +

  # Adding "a, b, c" labels above the boxplots
  geom_text(aes(x = "AMB", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "AMB"]), label = "a"), 
            vjust = -0.5, size = 5, color = "black") +
  geom_text(aes(x = "ELEV", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "ELEV"]), label = "b"), 
            vjust = -0.5, size = 5, color = "black") +
  geom_text(aes(x = "HI", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "HI"]), label = "c"), 
            vjust = -0.5, size = 5, color = "black") +
  geom_text(aes(x = "XHI", y = max(bottle_d$Avg.TA[bottle_d$Treatment == "XHI"]), label = "c"), 
            vjust = -0.5, size = 5, color = "black") +

  # Adding "n=xx" inside the lower right of the boxes (Q1 position)
  geom_text(data = sample_sizes, 
            aes(x = Treatment, y = lower_whisker, label = paste0("n=", n)), 
            hjust = 1.1, vjust = 1.2, size = 4.2, color = "black") +

  coord_cartesian(ylim = y_limits)

box_ta

```
#### Treatment stability over time  

```{r}
# Summarize the data to create mean and std dev for each day by treatment
#convert date column to "Date" type.
bottle_d$Date <- as.Date(bottle_d$Date, format = "%m/%d/%Y")

# Get the unique dates from the data
unique_dates <- unique(bottle_d$Date)
summary_data <- bottle_d %>%
  group_by(Date, Treatment) %>%
  summarise(
    mean_ta = mean(Avg.TA),
    se_ta = sd(Avg.TA) / sqrt(n())
  ) %>%
  ungroup()

# Plot the summarized data
treat_stab2 <- ggplot(summary_data, aes(x = Date, y = mean_ta, colour = Treatment)) +
  geom_jitter(alpha=0.5)+
  geom_point(size = 3.5) +
  geom_linerange(aes(ymin = mean_ta - se_ta, ymax = mean_ta + se_ta)) +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  ylab(expression(TA ~ (mu ~ mol))) +
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d/%Y") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  scale_colour_discrete(labels = dose_names)

treat_stab2
```

#### TreatStability_Time_AllDataPoints  


```{r}

# Plot the summarized data

treat_stab <- ggplot(bottle_d, aes(x = Date, y = Avg.TA)) +
  # Scatter points: jittered points with color (Treatment) and shape (Coral Type)
  geom_jitter(aes(colour = Treatment), alpha = 0.3) +
  
  # Error bars (Mean ± CI)
  stat_summary(aes(x = Date, y = Avg.TA, colour = Treatment),
               fun.data = "mean_cl_boot", geom = "errorbar", 
               width = 0.2, position = position_dodge(width = 1)) +

  # Mean points (Summary points with Treatment color)
  stat_summary(aes(x = Date, y = Avg.TA, colour = Treatment, fill = Treatment, shape = ifelse(Coral == "Blank", "Blank", "Coral")),
               size = 4, fun.data = "mean_cl_boot", geom = "point",
               position = position_dodge(width = 1)) +

  # X-axis formatting
  scale_x_date(breaks = unique_dates, date_labels = "%b %d") +
  ylab(expression(Total~alkalinity ~ (mu~mol~kg^-1))) +
  
  # Theme adjustments
  theme_classic(base_size = 15) +
  theme(axis.text.x = element_text(angle = 65, hjust = 1),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20),
        axis.text = element_text(size = 19),
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 18)) +

  # Treatment colors
  scale_colour_manual(values = treatment_colors, labels = dose_names) +
  scale_fill_manual(values = treatment_colors, labels = dose_names) +

  # Shape legend (Triangles for Blanks, Circles for others)
  scale_shape_manual(values = c("Blank" = 17, "Coral" = 16), name = "Beaker content") +

  # Hiding shape from the Treatment legend (only circles show there)
  guides(shape = guide_legend(order = 2), colour = guide_legend(order = 1), fill = "none") +

  # Legends labeling
  labs(colour = expression(Treatment ~ A[ T ]), 
       fill = expression(Treatment ~ A[ T ]), 
       shape = "Coral Type") + 

  # Limit y-axis range
  coord_cartesian(ylim = y_limits)

treat_stab


```

```{r}

TA_summary_plot <- ggarrange(
  treat_stab + theme(legend.position = "right", plot.margin = margin(5, 5, 50, 5)),  
  box_ta + theme(legend.position = "none"),
  labels = c("A", "B"),
  ncol = 2, nrow = 1, widths = c(4, 2), align = "h",
  common.legend = TRUE, legend = "right"
)


TA_summary_plot

```


### Blanks  

Total alkalinity in blanks by treatment

  
```{r}

#convert beaker to categorical var
bottle_d$Beaker <- as.factor(bottle_d$Beaker)

bottle_d$Date <- as.Date(bottle_d$Date, format = "%m/%d/%Y")  #Adjust the format according to your actual date format

# Get the unique dates from the data
unique_dates <- unique(bottle_d$Date)

blanks_amb <- ggplot(subset(bottle_d, Beaker %in% c("13", "44")), aes(Date, Avg.TA, color = Beaker)) +
  geom_point() +
  geom_line()+
  labs(title = "Ambient")+
  ylab(expression(Total~alkalinity ~ (mu~mol~kg^-1)))+
  theme_classic(base_size = 14)+
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        )+
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d")+
  scale_color_manual(values = c("13" = "slategray4", "44" = "black"))

blanks_elev <- ggplot(subset(bottle_d, Beaker %in% c("3", "33")), aes(Date, Avg.TA, color = Beaker)) +
  geom_point()+
  geom_line()+
  labs(title = "+1200 umol")+
  ylab(expression(Total~alkalinity ~ (mu~mol~kg^-1)))+
  theme_classic(base_size = 14)+
   theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d")+scale_color_manual(values = c("33" = "slategray4", "3" = "black"))

blanks_hi <- ggplot(subset(bottle_d, Beaker %in% c("22", "27")), aes(Date, Avg.TA, color = Beaker)) +
  geom_point()+
  geom_line()+
  labs(title = "+1750 umol")+
  ylab(expression(Total~alkalinity ~ (mu~mol~kg^-1)))+
  theme_classic(base_size = 14)+
   theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d")+scale_color_manual(values = c("22" = "slategray4", "27" = "black"))

blanks_xhi <- ggplot(subset(bottle_d, Beaker %in% c("11", "40")), aes(Date, Avg.TA, color = Beaker)) +
  geom_point()+
  geom_line()+
  labs(title = "+1850 umol")+
  ylab(expression(Total~alkalinity ~ (mu~mol~kg^-1)))+
  theme_classic(base_size = 14)+
   theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_x_date(breaks = unique_dates, date_labels = "%m/%d")+scale_color_manual(values = c("11" = "slategray4", "40" = "black"))


blanks_amb
blanks_elev
blanks_hi
blanks_xhi

blA <- blanks_amb + xlab(NULL) + ylim(1000, 6000) + theme(legend.position = c(0.9, 0.9), plot.title = element_text(hjust = 0.5))

blE <- blanks_elev + xlab(NULL) + ylab(NULL) +ylim(1000, 6000)+theme(legend.position = c(0.9, 0.9), plot.title = element_text(hjust = 0.5))

blH <- blanks_hi + ylim(1000, 6000) +
  theme(legend.position = c(0.9, 0.9), plot.title = element_text(hjust = 0.5))

blX <- blanks_xhi + ylab(NULL) + ylim(1000, 6000) +
  theme(legend.position = c(0.9, 0.9), plot.title = element_text(hjust = 0.5))

```

#### Blanks summary plot
```{r}
blanks_summary_plot <- ggarrange(blA, blE, blH, blX, labels = c("A", "B", "C", "D"), ncol = 2, nrow = 2, align = "h")

blanks_summary_plot
```

## TotalCalcification_Alkalinity  

### Linear mixed effect models  
#### T0 -> T3 (before lights fixed)
to check for random effects (tank, genotype)
BW from t0 to t3, growth ~ ta, 1|geno, 1|tank



```{r}
#BW mixed effect linear model 1
LM_BWTA1 <- lmerTest::lmer(gr_t0t3 ~ avg_ta_mmol + (1|geno) + (1|tank), data = grdata)
summary(LM_BWTA1)
anova(LM_BWTA1)
ranova(LM_BWTA1)
step(LM_BWTA1)
plot(LM_BWTA1)

```

Appears there is a tank effect on bw growth when using t0 to t3 growth points... Makes sense because of my lights!  

#### T1 -> T3 (after lights fixed)
```{r}
#BW mixed effect linear model 2
LM_BWTA2 <- lmerTest::lmer(gr_t1t3 ~ avg_ta_mmol + (1|geno) + (1|tank), data = grdata)
summary(LM_BWTA2)
anova(LM_BWTA2)
ranova(LM_BWTA2)
step(LM_BWTA2)
plot(LM_BWTA2)
```

Using the timepoint after the lights were fixed eliminates the tank effect.  

Simplest linear model: 
```{r}
LM_BWTA2a <- lm(gr_t1t3 ~ avg_ta_mmol, data = grdata)
summary(LM_BWTA2a)
anova(LM_BWTA2a)
plot(LM_BWTA2a)

bw_slope <- coef(LM_BWTA2a)["avg_ta_mmol"]
bw_intercept <- coef(LM_BWTA2a)[1]  # Intercept
bw_summary_model <- summary(LM_BWTA2a)
bw_r_squared <- summary(LM_BWTA2a)$r.squared
bw_pvalue <- summary(LM_BWTA2a)$coefficients[2, 4]


bw_r_squared
bw_slope
bw_pvalue
bw_intercept
```

Total alkalinity does have an effect on total calcification (p < 0.001)  
R-squared: 0.440 

slope: 0.192  



### Plots  
#### TA_total calcification (Linear regression, T0-T3)

```{r,fig.cap="Effect of total alkalinity on calcification (standardized to initial surface area) from Feb 3rd to Mar23rd. (p < 0.000" }
#define custom labels for genotype
labels_genotype <- c("C" = "Coopers",
                     "M" = "Marker 9",
                     "S" = "Sunny Isles")

bwt0t3 <- ggplot(data = grdata, aes(x = avg_ta, y = gr_t0t3, colour = geno)) +
  geom_point(aes(shape = treatment)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_discrete(labels = labels_genotype) +
  scale_shape_discrete(labels = dose_names) +  # Applying dose_names to treatment legend
  xlab(expression(TA~(mu~mol))) + 
  ylab(expression(Growth~rate~(mg~cm^2 ^-1~day^-1))) + 
  labs(colour = "Genotype", shape = "dose (mL)") +  # Changing the title of the treatment legend
  theme_classic()
   

bwt0t3

```


```{r, fig.cap="total calcification growth rates by treatment from t0 to t3"}
bwt0t3bar <- ggplot(data = grdata, aes(x=treatment, y=gr_t0t3))+
  geom_boxplot()+
  theme_classic() +
  labs(x = "Treatment") +
  ylab(expression(Growth~rate~(mg~cm^2^-1~day^-1)))


bwt0t3bar
  
```

#### TA_total calcification (Linear regression, T1-T3)
```{r, fig.cap="Effect of total alkalinity on calcification (standardized to initial surface area) from Feb 19th to Mar 23rd. p < 0.000" }
bwt1t3 <- ggplot(data = grdata, aes(x = avg_ta, y = gr_t1t3, colour = treatment)) +
  geom_point(aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_discrete(labels = labels_genotype) +
  scale_shape_discrete(labels = dose_names) +  # Applying dose_names to treatment legend
  xlab(expression(TA~(mu~mol~kg^-1))) + 
  ylab(expression(Growth~rate~(mg~cm^2 ^-1~day^-1))) + 
  labs(colour = "Genotype", shape = "dose (mL)") +  # Changing the title of the treatment legend
  theme_classic()
bwt1t3
```


```{r, fig.cap="total calcification growth rates by treatment from t1 to t3"}
bwt1t3bar <- ggplot(data = grdata, aes(x=treatment, y=gr_t1t3))+
  geom_boxplot()+
  theme_classic() +
  labs(x = "Treatment") +
  ylab(expression(Growth~rate~(mg~cm^2^-1~day^-1)))


bwt1t3bar
```

## LinearExtension_Alkalinity  

### Linear mixed effect models  

#### T0 -> T3  

Mixed effect model to check for genotype and tank effects on linear extension (used linear extension growth rates with the offsets)  

```{r,}
#LE mixed effect linear model t0-t3
LM_LETA <- lmerTest::lmer(le_t0t3e ~ avg_ta_mmol + (1|geno) + (1|tank), data = grdata)
summary(LM_LETA)
anova(LM_LETA)
ranova(LM_LETA)
step(LM_LETA)
plot(LM_LETA)
```

no tank of genotype effect, but also no significant effect of TA on linear extension. 

#### T1 -> T3  '
```{r}
#LE mixed effect linear model t1-t3
LM_LETA2 <- lmerTest::lmer(le_t1t3e ~ avg_ta_mmol + (1|geno) + (1|tank), data = grdata)
summary(LM_LETA2)
anova(LM_LETA2)
ranova(LM_LETA2)
step(LM_LETA2)
plot(LM_LETA2)
```


 
no genotype p = 0.60

```{r}
LM_LETA2a <- lm(le_t1t3e ~ avg_ta_mmol, data = grdata)
summary(LM_LETA2a)
anova(LM_LETA2a)
plot(LM_LETA2a)

le_slope <- coef(LM_LETA2a)["avg_ta_mmol"]
le_intercept <- coef(LM_LETA2a)[1]  # Intercept
le_summary_model <- summary(LM_LETA2a)
le_r_squared <- summary(LM_LETA2a)$r.squared
le_pvalue <- summary(LM_LETA2a)$coefficients[2, 4]

le_slope
le_intercept
le_summary_model
le_r_squared
le_pvalue
```

Simplest linear model produces p = 0.0527  
r-squared: 0.095  
slope: 0.014  
geno: 0.60
### Plots  

#### TA_LinearExtension (T0-T3)  


```{r, fig.cap="Effect of TA on linear extension from Feb 3rd to Mar 23rd. No statistically significant effect (p = 0.095)"}
#LE scatter plot w linear regression t0-t3
let0t3 <- ggplot(data = grdata, aes(x = avg_ta, y = le_t0t3e, colour = geno)) +
  geom_point(aes(shape = treatment)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_discrete(labels = labels_genotype) +
  scale_shape_discrete(labels = dose_names) +  # Applying dose_names to treatment legend
  xlab(expression(TA~(mu~mol))) + 
  ylab(expression(Growth~rate~(mm~day^-1))) + 
  labs(colour = "Genotype", shape = "dose (mL)") +  # Changing the title of the treatment legend
  theme_classic()

let0t3
   


```


```{r, fig.cap="linear extension growth rates by treatment from t0 to t3"}
let0t3bar <- ggplot(data = grdata, aes(x=treatment, y=le_t0t3e))+
  geom_boxplot()+
  theme_classic() +
  labs(x = "Treatment") +
  ylab(expression(Growth~rate~(mm~day^-1)))


let0t3bar
```

#### TA_LinearExtension (T1-T3)  

```{r, fig.cap="Effect of TA on linear extension from Feb 19th to Mar 23rd. Significant effect (P = 0.038)"}
#LE scatter plot w linear regression t0-t3
let1t3 <- ggplot(data = grdata, aes(x = avg_ta, y = le_t1t3e, colour = treatment)) +
  geom_point(aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_discrete(labels = labels_genotype) +
  scale_shape_discrete(labels = dose_names) +  # Applying dose_names to treatment legend
  xlab(expression(TA~(mu~mol))) + 
  ylab(expression(Growth~rate~(mm~day^-1))) + 
  labs(colour = "Genotype", shape = "dose (mL)") +  # Changing the title of the treatment legend
  theme_classic()

let1t3
   

```

#### Total_LE_Growth(mm)_TA  
```{r}
total_le <- read.csv('data2/TotalLE.csv', stringsAsFactors = TRUE)

leTOTAL <- ggplot(data = total_le, aes(x = avg_ta, y = t1t3, colour = treatment)) +
  geom_point(aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_discrete(labels = labels_genotype) +
  scale_shape_discrete(labels = dose_names) +  # Applying dose_names to treatment legend
  xlab(expression(TA~(mu~mol))) + 
  ylab("Total growth (mm)") + 
  labs(colour = "Genotype", shape = "dose (mL)") +  # Changing the title of the treatment legend
  theme_classic()

leTOTAL
   


```


```{r, fig.cap="linear extension growth rates by treatment from t1 to t3"}
let1t3bar <- ggplot(data = grdata, aes(x=treatment, y=le_t1t3e))+
  geom_boxplot()+
  theme_classic() +
  labs(x = "Treatment") +
  ylab(expression(Growth~rate~(mm~day^-1)))


let1t3bar
```

linear extension-- total growth vs TA. 

## Final Growth Figures
### BW subplots
```{r}

#Generate group CLD letters
bw_aov <- lm(gr_t1t3 ~ treatment, data = grdata)
 summary(bw_aov)
 
BWemmean<-cld(emmeans(bw_aov, ~treatment), Letters = letters)

BWemmean 

pairs(emmeans(bw_aov, ~treatment), adjust = "tukey")

bwcld <- grdata %>%
  group_by(treatment) %>%
  summarise(max_value = max(gr_t1t3)) %>%
    mutate(
    label = c("a", "b", "b", "b"),
    max_value = if_else(treatment == "HI", 0.87, max_value)  # Manually set max_value for +1750 µm
  )

#Calc summary boxplot
bw_boxsum <- ggplot(grdata, aes(x=treatment, y=gr_t1t3, fill=treatment))+
  geom_boxplot()+
  ylab(NULL) +
  xlab("Treatment")+
  scale_x_discrete(labels = dose_names)+
  theme_classic(base_size = 14)+
  theme(plot.margin=unit(c(1,1,1,1), 'cm'))+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))+
   theme(
    axis.title.x = element_text(size = 20),    # Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18)     # Optionally adjust legend title size
  ) +
  scale_fill_manual(values = treatment_colors, labels = dose_names)+
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]))+
  geom_text(data = bwcld, aes(x = treatment, y = max_value, label = label), 
            vjust = -0.5, size = 5)


bw_boxsum



# Create scatter plot 
bw_scat <- ggplot(data = grdata, aes(x = avg_ta, y = gr_t1t3, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
   scale_colour_manual(values = treatment_colors, labels = dose_names ) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu~mol~kg^-1))) +
  ylab(expression(Calcification~rate~(mg~cm^-2~day^-1))) + 
   labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) + 
   theme(
    axis.title.x = element_text(size = 20),# Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18),
    legend.position = c(0.8, 0.15),
    legend.box = "horizontal") +
  
  annotate("text", x = 3020, y = 1.2,
           label = paste("slope =", round(bw_slope, 2), " R² =", round(bw_r_squared, 3), " p < 0.00001"), 
           color = "black", size = 7,
           fontface = "bold")


  

bw_scat

```

### BW finalplot
```{r}
library(ggpubr)  # Ensure ggpubr is loaded
bw_scat <- bw_scat + theme(axis.title.x = element_text(hjust = 0.5, vjust = 3))

bw_summary_plot <- ggarrange(
  bw_scat,
  bw_boxsum + theme(legend.position = "none"),
  labels = c("A", "B"),
  ncol = 2, nrow = 1, widths = c(4, 2),
  align = "h"
)

bw_summary_plot
```

### LE subplots  


```{r}
#Generate group CLD letters


le_ta <- lm(le_t1t3e ~avg_ta, data = growth_2000)
summary(le_ta)
le_aov <- lm(le_t1t3e ~ treatment, data = growth_all)
summary(le_aov)
 
LEemmean<-cld(emmeans(le_aov, ~treatment), Letters = letters)

LEemmean 

lecld <- grdata %>%
  group_by(treatment) %>%
  summarise(max_value = max(le_t1t3e)) %>%
  mutate(label = c("a", "a", "a", "a"))  # Your specific labels



```

LE boxplot summary
```{r}
le_box <- ggplot(grdata, aes(x= treatment, y = le_t1t3e, fill = treatment))+
                   geom_boxplot()+
  ylab(NULL) +
  xlab("Treatment")+
  scale_x_discrete(labels = dose_names)+
  theme_classic(base_size = 14)+
  theme(plot.margin=unit(c(1,1,1,1), 'cm'))+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))+
   theme(
    axis.title.x = element_text(size = 20),    # Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18),
    # Optionally adjust legend title size
  ) +
  scale_fill_manual(values = treatment_colors, labels = dose_names)+
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]))+
   geom_text(data = lecld, aes(x = treatment, y = max_value, label = label), 
            vjust = -0.5, size = 5)+
   coord_cartesian(ylim = c(min(grdata$le_t1t3e), max(grdata$le_t1t3e)))


le_box
                   
```

LE scatter plot

```{r}
# Create scatter plot 
le_scat <- ggplot(data = grdata, aes(x = avg_ta, y = le_t1t3e, colour = treatment)) +
  geom_point(size = 2, aes(shape = geno)) +
  geom_smooth(color = 1, method = 'lm', se = TRUE, linetype = "dashed") +
  scale_colour_manual(values = treatment_colors, labels = dose_names) +  # Use scale_colour_manual to apply treatment_colors
  scale_shape_discrete(labels = labels_genotype) +  # Apply labels to the genotype legend
  xlab(expression(Total~alkalinity ~ (mu~mol~kg^-1))) + 
  ylab(expression(Linear~Extension~(mm~day^-1))) + 
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]), shape = "Genotype")+
  theme_classic(base_size = 14) +
   theme(
    axis.title.x = element_text(size = 20),    # Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18),
    legend.position = c(0.8, 0.15),
    legend.box = "horizontal"# Optionally adjust legend title size
  ) +
  coord_cartesian(ylim = c(min(grdata$le_t1t3e), max(grdata$le_t1t3e))) +  # Explicitly set y-axis limits
  annotate("text", x = 3000, y = 0.13, 
           label = paste("slope =", round(le_slope, 2), " R² =", round(le_r_squared, 3), " p =", signif(le_pvalue, 3)), 
           color = "black", size = 7, fontface = "bold")

le_scat

```

### LE finalplot  

```{r}
le_scat <- le_scat + theme(axis.title.x = element_text(hjust = 0.5, vjust = 3))

le_summary_plot <- ggarrange(
  le_scat,
  le_box + theme(legend.position = "none"),
  labels = c("A", "B"),
  ncol = 2, nrow = 1, widths = c(4, 2),
  align = "h"
)

le_summary_plot

```

### GrowthXtime

Bw summary
```{r}
# Combine data for faceting
bwlong <- grdata %>%
  pivot_longer(cols = starts_with("gr_"), 
               names_to = "timepoint", 
               values_to = "growth_rate") %>%
   filter((timepoint %in% c("gr_t1t2", "gr_t2t3")))
  
  
y_limits <- range(c(bwlong$growth_rate, grdata$gr_t1t3))

bw_grxtime <- ggplot(bwlong, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(x = "Timepoints", fill = "Dose (mL)") +
  ylab(expression(Calcification~(mg~cm^2^-1~day^-1))) +
  xlab(NULL)+
   scale_fill_manual(values = treatment_colors, labels = dose_names)+
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]))+
  scale_x_discrete(labels = c("Feb 19 - Mar 8","Mar 8 - Mar 23"))+
  theme_classic()
  

bw_grxtime

```
LE summary
```{r}
# Convert the data from wide format to long format
lelong <- grdata %>%
  pivot_longer(cols = starts_with("le_"), 
               names_to = "timepoint", 
               values_to = "growth_rate") %>%
   filter((timepoint %in% c("le_t1t2e", "le_t2t3e")))
  

# Determine the y-axis limits
y_limits <- range(c(lelong$growth_rate, grdata$le_t1t3e))

le_grxtime <- ggplot(lelong, aes(x = timepoint, y = growth_rate, fill = treatment)) +
  geom_boxplot() +
  labs(colour = expression(Treatment ~ A[ T ]), fill =  expression(Treatment ~ A[ T ]))+
  xlab(NULL)+
   ylab(expression(Linear~Extension~(mm~day^-1))) +
  theme_classic() +
     scale_fill_manual(values = treatment_colors, labels = dose_names) +
  scale_x_discrete(labels = c("Feb 19 - Mar 8","Mar 8 - Mar 23"))

le_grxtime
```

```{r}
grxtime_summary <- ggarrange(
  bw_grxtime + theme(legend.position = "right",axis.text.x = element_blank(), axis.ticks.x = element_blank()),
  le_grxtime + theme(legend.position = "none"),
  labels = c("A", "B"),
  ncol = 1, nrow = 2,
  align = "v"
)

grxtime_summary
```

Growth over time -- regression 

```{r}

bw_grxtime_r <- ggplot(grdata, aes(x = avg_ta, y = gr_t1t2)) +
  geom_point(aes(color = "gr_t1t2"), size = 2) +
  geom_smooth(aes(color = "gr_t1t2"), method = 'lm', se = TRUE) +
  geom_point(data = grdata, aes(x = avg_ta, y = gr_t2t3, color = "gr_t2t3"), size = 2) +  
  geom_smooth(data = grdata, aes(x = avg_ta, y = gr_t2t3, color = "gr_t2t3"), method = 'lm', se = TRUE) +  
  scale_color_manual(name = "Growth period", values = c("gr_t1t2" = "blue2", "gr_t2t3" = "firebrick2"), labels = c("Feb 19 to Mar 8", "Mar 8 to Mar 28")) +
  xlab(expression(Total~alkalinity ~ (mu~mol~kg^-1))) +
  ylab(expression(Calcification~rate~(mg~cm^2 ^-1~day^-1))) +
  theme_classic(base_size = 14)+
  theme(
    axis.title.x = element_text(size = 20),    # Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18),
    # Optionally adjust legend title size
  )
  

bw_grxtime_r


#linear extension 

le_grxtime_r <- ggplot(grdata, aes(x = avg_ta, y = le_t1t2e)) +
  geom_point(aes(color = "le_t1t2e"), size = 2) +
  geom_smooth(aes(color = "le_t1t2e"), method = 'lm', se = TRUE) +
  geom_point(data = grdata, aes(x = avg_ta, y = le_t2t3e, color = "le_t2t3e"), size = 2) +  
  geom_smooth(data = grdata, aes(x = avg_ta, y = le_t2t3e, color = "le_t2t3e"), method = 'lm', se = TRUE) +  
  scale_color_manual(name = "Growth period", values = c("le_t1t2e" = "blue2", "le_t2t3e" = "firebrick2"), labels = c("Feb 19 to Mar 8", "Mar 8 to Mar 28")) +
  xlab(expression(Total~alkalinity ~ (mu~mol~kg^-1))) +
  ylab(expression(Linear~Extenion~(mm~~day^-1))) +
  theme_classic(base_size = 14)+
  theme(
    axis.title.x = element_text(size = 20),    # Increase X-axis title size
    axis.title.y = element_text(size = 20),    # Increase Y-axis title size
    axis.text = element_text(size = 19),       # Increase axis label text size
    legend.text = element_text(size = 16),     # Optionally adjust legend text size
    legend.title = element_text(size = 18),
    # Optionally adjust legend title size
  )

le_grxtime_r
  
#Join figures

grxtime_r_summary <- ggarrange(
  bw_grxtime_r + theme(legend.position = c(0.2, 0.8)),
  le_grxtime_r + theme(legend.position = "none"),
  labels = c("A", "B"),
  ncol = 2, nrow = 1, widths = c(2, 2),
  align = "h")

grxtime_r_summary
```

Percent change in growth calculated from slopes
```{r}

# Calculate average growth rates for the two periods
growth_summary <- grdata %>%
  summarize(
    avg_gr_t1t2 = mean(gr_t1t2, na.rm = TRUE), # First half
    avg_gr_t2t3 = mean(gr_t2t3, na.rm = TRUE)  # Second half
  )

# Compute percent decrease
growth_summary <- growth_summary %>%
  mutate(percent_decrease = ((avg_gr_t1t2 - avg_gr_t2t3) / avg_gr_t1t2) * 100)

print(growth_summary)

linear_extension_summary <- grdata %>%
  summarize(
    avg_le_t1t2e = mean(le_t1t2e, na.rm = TRUE), # First half
    avg_le_t2t3e = mean(le_t2t3e, na.rm = TRUE)  # Second half
  ) %>%
  mutate(percent_decrease = ((avg_le_t1t2e - avg_le_t2t3e) / avg_le_t1t2e) * 100)

print(linear_extension_summary)

```


```


Call final figures
```{r}
TA_summary_plot
bw_summary_plot
le_summary_plot
grxtime_summary
```

